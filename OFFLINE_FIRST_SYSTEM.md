# ğŸ“± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª (Offline-First System)

**Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:** 100% Ù…ÙƒØªÙ…Ù„ âœ…

---

## ğŸ¯ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

Ù†Ø¸Ø§Ù… Ø´Ø§Ù…Ù„ Ù„Ù„Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª Ù…Ø¹:
- âœ… Ù…Ø±Ø¢Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- âœ… Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø°ÙƒÙŠØ© Ù…Ø¹ fallback
- âœ… Ø¹Ù…Ù„ÙŠØ§Øª CRUD offline-first
- âœ… Ù…Ø²Ø§Ù…Ù†Ø© batch ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
- âœ… Ø­Ù„ ØªØ¶Ø§Ø±Ø¹Ø§Øª Ø°ÙƒÙŠ
- âœ… Ø¶ØºØ· ÙˆØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- âœ… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡
- âœ… ÙˆØ§Ø¬Ù‡Ø© Ù…Ø³ØªØ®Ø¯Ù… Ø°ÙƒÙŠØ© Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„

---

## ğŸš€ Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø±ÙŠØ¹

```typescript
import { initOfflineSystem, offlineFirstMutation } from '@/offline';

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
await initOfflineSystem();

// Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ (ÙŠØ­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙˆÙŠØ²Ø§Ù…Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
const result = await offlineFirstMutation(
  'create',
  '/api/workers',
  'workers',
  'worker-123',
  { name: 'Ø£Ø­Ù…Ø¯', type: 'Ø¹Ø§Ù…Ù„' }
);

// Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ (ÙŠØ­Ø§ÙˆÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø«Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ)
const { data, source } = await getDataWithFallback(
  '/api/workers',
  'workers'
);
console.log(`Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†: ${source}`); // 'server' Ø£Ùˆ 'local'
```

---

## ğŸ“Š Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend UI                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ Mutations â”‚            â”‚  Queries    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  QueryClient (Smart)         â”‚          â”‚
    â”‚  - Connection Check          â”‚          â”‚
    â”‚  - Fallback Logic            â”‚          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”˜          â”‚
                                  â”‚           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                 â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
            â”‚   Offline-First Layer          â”‚
            â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
            â”‚ â”‚  Mutations (CRUD)        â”‚  â”‚
            â”‚ â”‚  - Create/Update/Delete  â”‚  â”‚
            â”‚ â”‚  - Queue for Sync        â”‚  â”‚
            â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
            â”‚ â”‚  Conflict Resolution     â”‚  â”‚
            â”‚ â”‚  - Detect Conflicts      â”‚  â”‚
            â”‚ â”‚  - Resolve Strategies    â”‚  â”‚
            â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
            â”‚ â”‚  Sync Engine             â”‚  â”‚
            â”‚ â”‚  - Batch Sync            â”‚  â”‚
            â”‚ â”‚  - Retry Logic           â”‚  â”‚
            â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                      â”‚
        â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”
        â”‚IndexedDB         â”‚  API      â”‚
        â”‚Storage   â”‚       â”‚  Server   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹

```
client/src/offline/
â”œâ”€â”€ index.ts                      # Ù†Ù‚Ø·Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
â”œâ”€â”€ db.ts                         # Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
â”œâ”€â”€ sync.ts                       # Ù…Ø­Ø±Ùƒ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
â”œâ”€â”€ sync-loader.ts                # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
â”œâ”€â”€ offline.ts                    # Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
â”œâ”€â”€ offline-queries.ts            # Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø°ÙƒÙŠØ©
â”œâ”€â”€ offline-mutations.ts          # Ø¹Ù…Ù„ÙŠØ§Øª CRUD
â”œâ”€â”€ conflict-resolver.ts          # Ø­Ù„ Ø§Ù„ØªØ¶Ø§Ø±Ø¹Ø§Øª
â”œâ”€â”€ data-compression.ts           # Ø¶ØºØ· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
â”œâ”€â”€ data-encryption.ts            # ØªØ´ÙÙŠØ± Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø­Ø³Ø§Ø³Ø©
â”œâ”€â”€ data-cleanup.ts               # ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
â””â”€â”€ performance-monitor.ts        # Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡
```

---

## ğŸ”„ Ø³ÙŠØ± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©

```
1. User Action
   â””â”€> offlineFirstMutation()
       â”œâ”€> Try Server (if online)
       â”œâ”€> If Success: update local + cache
       â””â”€> If Fail: save locally + queue for sync

2. Queue for Sync
   â””â”€> queueForSync()
       â””â”€> Add to syncQueue

3. Sync Engine
   â”œâ”€> Check Connection
   â”œâ”€> Try Batch Endpoint
   â”œâ”€> Fallback to Individual
   â”œâ”€> Handle Conflicts (if any)
   â””â”€> Update Cache

4. Conflict Resolution
   â”œâ”€> Detect Conflict
   â”œâ”€> Apply Strategy (LWW, Server-Wins, Client-Wins, Merge)
   â””â”€> Log Conflict

5. Completion
   â””â”€> Remove from Queue
       â””â”€> invalidateCache()
```

---

## ğŸ’¾ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©

**13 Ø¬Ø¯Ø§ÙˆÙ„ ÙÙŠ IndexedDB:**

```typescript
const stores = {
  syncQueue: { keyPath: 'id' },
  userData: { keyPath: 'id' },
  projects: { keyPath: 'id' },
  workers: { keyPath: 'id' },
  materials: { keyPath: 'id' },
  suppliers: { keyPath: 'id' },
  workerAttendance: { keyPath: 'id' },
  materialPurchases: { keyPath: 'id' },
  transportationExpenses: { keyPath: 'id' },
  fundTransfers: { keyPath: 'id' },
  workerTransfers: { keyPath: 'id' },
  workerMiscExpenses: { keyPath: 'id' },
  wells: { keyPath: 'id' },
  projectTypes: { keyPath: 'id' },
  syncMetadata: { keyPath: 'key' }
};
```

---

## ğŸ” Ø§Ù„Ø£Ù…Ø§Ù†

**ØªØ´ÙÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø­Ø³Ø§Ø³Ø©:**

```typescript
const SENSITIVE_FIELDS = [
  'password',
  'token',
  'secret',
  'apiKey',
  'ssn',
  'bankAccount'
];

// Ø§Ù„ØªØ´ÙÙŠØ± ÙŠØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
encryptRecord(userData);
decryptRecord(storedData);
```

---

## âš¡ Ø§Ù„Ø£Ø¯Ø§Ø¡

**Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:**

- **Ø¶ØºØ· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:** 20-40% ØªÙˆÙÙŠØ± ÙÙŠ Ø§Ù„Ø­Ø¬Ù…
- **Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ù„Ù„ØªØ®Ø²ÙŠÙ†:** ~50MB (Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙØ­)
- **Ù…Ø¯Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©:** < 5 Ø«ÙˆØ§Ù†Ù Ø¹Ø§Ø¯Ø©
- **Ø¹Ø¯Ø¯ Ø¥Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©:** 5 Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„ÙØ´Ù„

---

## ğŸ“Š Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©

```typescript
// Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
const metrics = await collectMetrics();

// Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
const stats = getPerformanceStats();

// Ø§Ø·Ø¨Ø¹ ØªÙ‚Ø±ÙŠØ±
await printPerformanceReport();

// Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ©
startPerformanceMonitoring(60000); // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
```

---

## ğŸ§¹ Ø§Ù„ØªÙ†Ø¸ÙŠÙ

```typescript
// Ø§Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (Ø£ÙƒØ¨Ø± Ù…Ù† 30 ÙŠÙˆÙ…)
await deleteOldRecords('workers', 30 * 24 * 60 * 60 * 1000);

// Ù†ÙØ° Ø³ÙŠØ§Ø³Ø© Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙƒØ§Ù…Ù„Ø©
await runCleanupPolicy();

// Ø§Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ØªØ­Ø°ÙŠØ±!)
await clearAllLocalData();
```

---

## ğŸ¤ Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ React Query

```typescript
// Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ© Ù…Ø¹ React Query
const { data } = useQuery({
  queryKey: ['/api/workers'],
  queryFn: () => getDataWithFallback('/api/workers', 'workers'),
  staleTime: 5 * 60 * 1000 // 5 Ø¯Ù‚Ø§Ø¦Ù‚
});
```

---

## ğŸ“ˆ Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø±Ø§Ø­Ù„

| Ø§Ù„Ù…Ø±Ø­Ù„Ø© | Ø§Ù„ÙˆØµÙ | Ø§Ù„Ø­Ø§Ù„Ø© |
|--------|-------|--------|
| 1 | Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ | âœ… 100% |
| 2 | Ù…Ø±Ø¢Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª | âœ… 100% |
| 3 | Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ© | âœ… 100% |
| 4 | Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠ | âœ… 100% |
| 5 | Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ø£Ù…Ø§Ù† | âœ… 100% |
| 6 | ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„ØªØ±Ø§Ø¬Ø¹ Ø§Ù„Ø°ÙƒÙŠ | âœ… 100% |

**Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:** 100% âœ…

---

## ğŸš€ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©

1. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙÙŠ Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬
2. ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª
3. ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¯ÙˆØ±ÙŠØ© Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù†

---

**Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:** 16 ÙŠÙ†Ø§ÙŠØ± 2026
