# ุฎุทุฉ ูุธุงู ุงููุฒุงููุฉ ุงููุชูุฏูุฉ - Offline-First Architecture

**ุงูุฅุตุฏุงุฑ:** 1.0  
**ุงูุชุงุฑูุฎ:** 2025-12-30  
**ุงูุญุงูุฉ:** ููุฏ ุงูุชุทููุฑ  

---

## ๐ฏ ุงูุฑุคูุฉ ุงููุจุฑู

ุจูุงุก ูุธุงู ูุฒุงููุฉ ูุชูุฏู ูุฌุนู ุงูุชุทุจูู ูุนูู ุจูุงูู ุทุงูุชู ุญุชู ุจุฏูู ุฅูุชุฑูุชุ ูุน ูุงุนุฏุฉ ุจูุงูุงุช ูุญููุฉ ูุทุงุจูุฉ ุชูุงูุงู ููุฎุงุฏู.

---

## ๐ ูุนูุงุฑูุฉ ุงููุธุงู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Frontend (React)                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ         UI Layer (Pages & Components)               โ โ
โ  โโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโ โ
โ           โ                                   โ           โ
โ  โโโโโโโโโโผโโโโโโโโโ              โโโโโโโโโโโโผโโโโโโโโ   โ
โ  โ  Query Client   โ              โ Sync Manager     โ   โ
โ  โ  (React Query)  โ              โ (offline/sync.ts)โ   โ
โ  โโโโโโโโโโฌโโโโโโโโโ              โโโโโโโโโโโโฌโโโโโโโโ   โ
โ           โ                                   โ           โ
โ  โโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโ   โ
โ  โ    Local Storage Layer (IndexedDB)                โ   โ
โ  โ  - userData (user interactions)                   โ   โ
โ  โ  - syncQueue (pending operations)                โ   โ
โ  โ  - Full Database Mirror:                         โ   โ
โ  โ    * projects, workers, materials                โ   โ
โ  โ    * workerAttendance, fundTransfers             โ   โ
โ  โ    * transportationExpenses, etc.                โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โ (Online Connection)
              โ
โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  API Server (Express)                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ         REST API Endpoints                         โ   โ
โ  โ  - Standard CRUD operations                       โ   โ
โ  โ  - Batch sync endpoint (/api/sync/batch)         โ   โ
โ  โ  - Conflict resolution logic                      โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ           PostgreSQL Database                             โ
โ     (Source of Truth)                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุฏูุฑุฉ ุนูู ุงููุฒุงููุฉ

### ุงูุณููุงุฑูู 1: ุจุฏูู ุฅูุชุฑูุช โ๏ธ
1. ุงููุณุชุฎุฏู ูุถูู ูุตุฑูู
2. ููุญูุธ ูุจุงุดุฑุฉ ูู IndexedDB
3. ููุถุงู ูู syncQueue ููุฅุฑุณุงู ูุงุญูุงู
4. ุงููุงุฌูุฉ ุชุนุฑุถ ุงูุจูุงูุงุช ูู IndexedDB

### ุงูุณููุงุฑูู 2: ุงุณุชุนุงุฏุฉ ุงูุงุชุตุงู ๐
1. ุงูุชุทุจูู ููุชุดู ุนูุฏุฉ ุงูุงุชุตุงู
2. ูุจุฏุฃ ูุฒุงููุฉ ุชููุงุฆูุฉ
3. ูุฑุณู ุฌููุน ุงูุจูุงูุงุช ุงููุนููุฉ
4. ูุญุตู ุนูู ุงูุชุญุฏูุซุงุช ูู ุงูุฎุงุฏู
5. ูุญู ุฃู ุชุถุงุฑุนุงุช
6. ูุญุฏูุซ IndexedDB
7. ูุนูุฏ ุชุญููู ุงููุงุฌูุฉ

---

## ๐ ุงููุฑุงุญู ูุงูููุงู

### ุงููุฑุญูุฉ 1: ุงูุชุฃุณูุณ (ุงูุญุงููุฉ) โก
**ุงููุฏุฉ:** 1-2 ููู ุนูู  
**ุงููุฏู:** ุจูุงุก ุงูุฃุณุงุณ ุงููุชูู

#### ุงูููุงู:
- [ ] 1.1 ุชุญุณูู ูุธุงู sync.ts (ุฅุถุงูุฉ retry logicุ logging)
- [ ] 1.2 ุชุญุฏูุซ offline.ts (ุฏุนู ุงูุจูุงูุงุช ุงููุงููุฉ)
- [ ] 1.3 ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู daily-expenses.tsx
- [ ] 1.4 ุงุฎุชุจุงุฑ ุงูุญูุธ ุงููุญูู ูุงููุฒุงููุฉ ุงูุฃุณุงุณูุฉ

### ุงููุฑุญูุฉ 2: ูุฑุขุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ๐
**ุงููุฏุฉ:** 2-3 ุฃูุงู ุนูู  
**ุงููุฏู:** ูุณุฎ ูุงููุฉ ูู ูู ุฌุฏุงูู ุงูุฎุงุฏู ูุญููุงู

#### ุงูููุงู:
- [ ] 2.1 ุฅูุดุงุก ููุทุฉ ููุงูุฉ `/api/sync/full-backup` ูุชุญููู ูู ุงูุจูุงูุงุช
- [ ] 2.2 ุชุญุฏูุซ db.ts ูุฅุถุงูุฉ ุฌุฏุงูู ูุญููุฉ ููู entity
- [ ] 2.3 ููู ุงูุจูุงูุงุช ูู ุงูุฎุงุฏู ุฅูู IndexedDB ุนูุฏ ุงูุชุญููู ุงูุฃูู
- [ ] 2.4 ุญูุธ ุจูุงูุงุช metadata ูููุฒุงููุฉ (timestamps)

### ุงููุฑุญูุฉ 3: ุงูุงุณุชุนูุงูุงุช ุงูุฐููุฉ ๐ง
**ุงููุฏุฉ:** 2-3 ุฃูุงู ุนูู  
**ุงููุฏู:** ูู query ุชุนุฑู ูู ุชุณุฃู ุงูุฎุงุฏู ุฃู ุงูู local DB

#### ุงูููุงู:
- [ ] 3.1 ุฅูุดุงุก queryClient ูุญุณูู ููุญุต ุงูุงุชุตุงู ุชููุงุฆูุงู
- [ ] 3.2 ุชุญุฏูุซ ุฌููุน queries ูุงุณุชุฎุฏุงู LocalDB ูู fallback
- [ ] 3.3 ุฅุถุงูุฉ function `getDataWithFallback()` ููู entity
- [ ] 3.4 ุชุญุฏูุซ ูุงุฌูุงุช ุงูุจูุงูุงุช (types)

### ุงููุฑุญูุฉ 4: ุงูุชุฒุงูู ุซูุงุฆู ุงูุงุชุฌุงู ๐
**ุงููุฏุฉ:** 3-4 ุฃูุงู ุนูู  
**ุงููุฏู:** ุชุทุจูู ูุนูู ุชูุงูุงู ุจุฏูู ุฅูุชุฑูุช

#### ุงูููุงู:
- [ ] 4.1 ุชุทููุฑ ููุทุฉ ููุงูุฉ batch sync `/api/sync/batch`
- [ ] 4.2 ุญู ุงูุชุถุงุฑุนุงุช (last-write-wins ุฃู merge)
- [ ] 4.3 ุชุญุฏูุซ logic ุฅุถุงูุฉ/ุญุฐู/ุชุนุฏูู ุงููุตุฑููุงุช
- [ ] 4.4 ุงุฎุชุจุงุฑ ุณููุงุฑูููุงุช ูุนูุฏุฉ (offline + edits + conflicts)

### ุงููุฑุญูุฉ 5: ุงูุฃุฏุงุก ูุงูุฃูุงู ๐
**ุงููุฏุฉ:** 1-2 ููู ุนูู  
**ุงููุฏู:** ุชุญุณูู ุงูุณุฑุนุฉ ูุงูุฃูุงู

#### ุงูููุงู:
- [ ] 5.1 ุชูููู ุญุฌู ุงูุจูุงูุงุช ุงูููุฑุณูุฉ (compression)
- [ ] 5.2 ุชุดููุฑ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ ูุญููุงู
- [ ] 5.3 ุชูุธูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ (old data)
- [ ] 5.4 ูุฑุงูุจุฉ ุงูุฃุฏุงุก ูุงูุฐุงูุฑุฉ

### ุงููุฑุญูุฉ 6: ุงูุงุฎุชุจุงุฑ ูุงููุดุฑ ๐
**ุงููุฏุฉ:** 1-2 ููู ุนูู  
**ุงููุฏู:** ุชุฃูุฏ ูู ุฌูุฏุฉ ุงูุญู

#### ุงูููุงู:
- [ ] 6.1 ุงุฎุชุจุงุฑ ุดุงูู ููุณููุงุฑูููุงุช ุงููุฎุชููุฉ
- [ ] 6.2 ุงุฎุชุจุงุฑ ุนูู ุฃุฌูุฒุฉ ูุฎุชููุฉ (mobile, tablet)
- [ ] 6.3 ุชูุซูู ุงูุญู ูุงูู best practices
- [ ] 6.4 ูุดุฑ ุฅูู ุงูุฅูุชุงุฌ ูุน monitoring

---

## ๐ฏ ุงููุนุงููุฑ ุงูุนุงูููุฉ

### ุฃุฏุงุก
- **ุงูุชุญููู ุงูุฃูู:** < 3 ุซูุงูู
- **ุงููุฒุงููุฉ:** < 5 ุซูุงูู (100 operation)
- **ุงูุงุณุชุฌุงุจุฉ UI:** < 100ms

### ุงูููุซูููุฉ
- **ูุนุฏู ูุฌุงุญ ุงููุฒุงููุฉ:** > 99.5%
- **ููุฏุงู ุงูุจูุงูุงุช:** 0% (ACID compliance)
- **ุงูุงุณุชุนุงุฏุฉ ูู ุงูุฃุฎุทุงุก:** ุชููุงุฆูุฉ (3 ูุญุงููุงุช ุฅุนุงุฏุฉ)

### ุงูุฃูุงู
- **ุชุดููุฑ ุงูุจูุงูุงุช:** AES-256 ููุจูุงูุงุช ุงูุญุณุงุณุฉ
- **ุงูุชุญูู:** JWT verification ุนูู ูู ุนูููุฉ
- **ุงูุชูุธูู:** ุญุฐู ุงูุจูุงูุงุช ุนูุฏ logout

---

## ๐ฑ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

```
โ Offline-First Architecture
โ Full Database Replication
โ Bi-directional Sync
โ Conflict Resolution
โ Automatic Retry Logic
โ Progress Indicators
โ Error Recovery
โ Data Compression
โ Encryption Support
โ Real-time Notifications
```

---

## ๐ ุงููููุงุช ุงููุฑุชุจุทุฉ

- **ACCEPTANCE_CRITERIA.md** - ูุนุงููุฑ ูุจูู ูู ูุฑุญูุฉ
- **TECHNICAL_STANDARDS.md** - ูุนุงููุฑ ุนุงูููุฉ ููููุฏ
- **replit.md** - ูุนูููุงุช ุงููุดุฑูุน ูุงูุชูุฏู

---

## ๐ ููุงุท ุงูุชูุงุตู

- **ูุฑุงุฌุน ุงูููุฏ:** `client/src/offline/*`ุ `server/routes/modules/syncRoutes.ts`
- **ุงูุงุฎุชุจุงุฑ:** ุตูุญุฉ daily-expenses.tsx
- **ุงููุฑุงูุจุฉ:** Browser consoleุ Server logs
